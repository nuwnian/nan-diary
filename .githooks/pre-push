#!/usr/bin/env bash
# pre-push hook: collect changed files and run the Node secret scanner
# This wrapper works on Unix-like environments (Git Bash / WSL)

# Get list of files that are about to be pushed (local commits not yet on remote)
files=$(git diff --name-only --staged || git diff --name-only HEAD)
if [ -z "$files" ]; then
  exit 0
fi

# Run the node scanner
node "$(git rev-parse --show-toplevel)/.githooks/secret-scan.js" $files
rc=$?
if [ $rc -ne 0 ]; then
  echo "pre-push secret-scan failed (exit $rc)"
  exit $rc
fi

exit 0
